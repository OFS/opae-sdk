\doxysection{include/opae/mmio.h File Reference}
\label{include_2opae_2mmio_8h}\index{include/opae/mmio.h@{include/opae/mmio.h}}


Functions for mapping and accessing MMIO space.  


{\ttfamily \#include $<$opae/types.\+h$>$}\newline
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} \mbox{\hyperlink{include_2opae_2mmio_8h_a6df7f745d9b9d47582714fe8e2d1a761}{fpga\+Write\+MMIO64}} (\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}} handle, uint32\+\_\+t mmio\+\_\+num, uint64\+\_\+t offset, uint64\+\_\+t value)
\item 
\mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} \mbox{\hyperlink{include_2opae_2mmio_8h_a011ba900710ddf70c13ca089c4742187}{fpga\+Read\+MMIO64}} (\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}} handle, uint32\+\_\+t mmio\+\_\+num, uint64\+\_\+t offset, uint64\+\_\+t $\ast$value)
\item 
\mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} \mbox{\hyperlink{include_2opae_2mmio_8h_ae538bfe7158d1911c5e749bbc063aa3d}{fpga\+Write\+MMIO32}} (\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}} handle, uint32\+\_\+t mmio\+\_\+num, uint64\+\_\+t offset, uint32\+\_\+t value)
\item 
\mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} \mbox{\hyperlink{include_2opae_2mmio_8h_a81dc89da3e94e26efff1af1eeebb7f5d}{fpga\+Read\+MMIO32}} (\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}} handle, uint32\+\_\+t mmio\+\_\+num, uint64\+\_\+t offset, uint32\+\_\+t $\ast$value)
\item 
\mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} \mbox{\hyperlink{include_2opae_2mmio_8h_a9cf56711df0f234686426c58d8b00cb0}{fpga\+Write\+MMIO512}} (\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}} handle, uint32\+\_\+t mmio\+\_\+num, uint64\+\_\+t offset, const void $\ast$value)
\item 
\mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} \mbox{\hyperlink{include_2opae_2mmio_8h_a2903267d37ea5c64522b0addce74da5f}{fpga\+Map\+MMIO}} (\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}} handle, uint32\+\_\+t mmio\+\_\+num, uint64\+\_\+t $\ast$$\ast$mmio\+\_\+ptr)
\item 
\mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} \mbox{\hyperlink{include_2opae_2mmio_8h_a8c8db22506e1fbfd16440c660bfee28f}{fpga\+Unmap\+MMIO}} (\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}} handle, uint32\+\_\+t mmio\+\_\+num)
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Functions for mapping and accessing MMIO space. 

Most FPGA accelerators provide access to control registers through memory-\/mappable address spaces, commonly referred to as \char`\"{}\+MMIO spaces\char`\"{}. This file provides functions to map, unmap, read, and write MMIO spaces.

Note that an accelerator may have multiple MMIO spaces, denoted by the {\ttfamily mmio\+\_\+num} argument of the APIs below. The meaning and properties of each MMIO space are up to the accelerator designer. 

\doxysubsection{Function Documentation}
\mbox{\label{include_2opae_2mmio_8h_a6df7f745d9b9d47582714fe8e2d1a761}} 
\index{mmio.h@{mmio.h}!fpgaWriteMMIO64@{fpgaWriteMMIO64}}
\index{fpgaWriteMMIO64@{fpgaWriteMMIO64}!mmio.h@{mmio.h}}
\doxysubsubsection{\texorpdfstring{fpgaWriteMMIO64()}{fpgaWriteMMIO64()}}
{\footnotesize\ttfamily \mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} fpga\+Write\+MMIO64 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}}}]{handle,  }\item[{uint32\+\_\+t}]{mmio\+\_\+num,  }\item[{uint64\+\_\+t}]{offset,  }\item[{uint64\+\_\+t}]{value }\end{DoxyParamCaption})}

Write 64 bit value to MMIO space

This function will write to MMIO space of the target object at a specified offset.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em handle} & Handle to previously opened accelerator resource \\
\hline
\mbox{\texttt{ in}}  & {\em mmio\+\_\+num} & Number of MMIO space to access \\
\hline
\mbox{\texttt{ in}}  & {\em offset} & Byte offset into MMIO space \\
\hline
\mbox{\texttt{ in}}  & {\em value} & Value to write (64 bit) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
FPGA\+\_\+\+OK on success. FPGA\+\_\+\+INVALID\+\_\+\+PARAM if any of the supplied parameters is invalid. FPGA\+\_\+\+EXCEPTION if an internal exception occurred while trying to access the handle. 
\end{DoxyReturn}


Referenced by fpga\+\_\+set\+\_\+switch(), fpga\+\_\+start(), fpga\+\_\+stop(), fpga\+\_\+test\+\_\+esram(), fpga\+\_\+test\+\_\+qdr(), and main().

\mbox{\label{include_2opae_2mmio_8h_a011ba900710ddf70c13ca089c4742187}} 
\index{mmio.h@{mmio.h}!fpgaReadMMIO64@{fpgaReadMMIO64}}
\index{fpgaReadMMIO64@{fpgaReadMMIO64}!mmio.h@{mmio.h}}
\doxysubsubsection{\texorpdfstring{fpgaReadMMIO64()}{fpgaReadMMIO64()}}
{\footnotesize\ttfamily \mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} fpga\+Read\+MMIO64 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}}}]{handle,  }\item[{uint32\+\_\+t}]{mmio\+\_\+num,  }\item[{uint64\+\_\+t}]{offset,  }\item[{uint64\+\_\+t $\ast$}]{value }\end{DoxyParamCaption})}

Read 64 bit value from MMIO space

This function will read from MMIO space of the target object at a specified offset.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em handle} & Handle to previously opened accelerator resource \\
\hline
\mbox{\texttt{ in}}  & {\em mmio\+\_\+num} & Number of MMIO space to access \\
\hline
\mbox{\texttt{ in}}  & {\em offset} & Byte offset into MMIO space \\
\hline
\mbox{\texttt{ out}}  & {\em value} & Pointer to memory where read value is returned (64 bit) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
FPGA\+\_\+\+OK on success. FPGA\+\_\+\+INVALID\+\_\+\+PARAM if any of the supplied parameters is invalid. FPGA\+\_\+\+EXCEPTION if an internal exception occurred while trying to access the handle. 
\end{DoxyReturn}


Referenced by find\+\_\+nlb\+\_\+n3000(), fpga\+\_\+banks(), fpga\+\_\+base(), fpga\+\_\+dump(), fpga\+\_\+read\+\_\+switch\+\_\+port(), fpga\+\_\+test\+\_\+ddr\+\_\+directed(), fpga\+\_\+test\+\_\+ddr\+\_\+prbs(), fpga\+\_\+test\+\_\+esram(), fpga\+\_\+test\+\_\+hbm(), fpga\+\_\+test\+\_\+qdr(), fpga\+\_\+wait(), and main().

\mbox{\label{include_2opae_2mmio_8h_ae538bfe7158d1911c5e749bbc063aa3d}} 
\index{mmio.h@{mmio.h}!fpgaWriteMMIO32@{fpgaWriteMMIO32}}
\index{fpgaWriteMMIO32@{fpgaWriteMMIO32}!mmio.h@{mmio.h}}
\doxysubsubsection{\texorpdfstring{fpgaWriteMMIO32()}{fpgaWriteMMIO32()}}
{\footnotesize\ttfamily \mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} fpga\+Write\+MMIO32 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}}}]{handle,  }\item[{uint32\+\_\+t}]{mmio\+\_\+num,  }\item[{uint64\+\_\+t}]{offset,  }\item[{uint32\+\_\+t}]{value }\end{DoxyParamCaption})}

Write 32 bit value to MMIO space

This function will write to MMIO space of the target object at a specified offset.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em handle} & Handle to previously opened accelerator resource \\
\hline
\mbox{\texttt{ in}}  & {\em mmio\+\_\+num} & Number of MMIO space to access \\
\hline
\mbox{\texttt{ in}}  & {\em offset} & Byte offset into MMIO space \\
\hline
\mbox{\texttt{ in}}  & {\em value} & Value to write (32 bit) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
FPGA\+\_\+\+OK on success. FPGA\+\_\+\+INVALID\+\_\+\+PARAM if any of the supplied parameters is invalid. FPGA\+\_\+\+EXCEPTION if an internal exception occurred while trying to access the handle. 
\end{DoxyReturn}


Referenced by main().

\mbox{\label{include_2opae_2mmio_8h_a81dc89da3e94e26efff1af1eeebb7f5d}} 
\index{mmio.h@{mmio.h}!fpgaReadMMIO32@{fpgaReadMMIO32}}
\index{fpgaReadMMIO32@{fpgaReadMMIO32}!mmio.h@{mmio.h}}
\doxysubsubsection{\texorpdfstring{fpgaReadMMIO32()}{fpgaReadMMIO32()}}
{\footnotesize\ttfamily \mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} fpga\+Read\+MMIO32 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}}}]{handle,  }\item[{uint32\+\_\+t}]{mmio\+\_\+num,  }\item[{uint64\+\_\+t}]{offset,  }\item[{uint32\+\_\+t $\ast$}]{value }\end{DoxyParamCaption})}

Read 32 bit value from MMIO space

This function will read from MMIO space of the target object at a specified offset.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em handle} & Handle to previously opened accelerator resource \\
\hline
\mbox{\texttt{ in}}  & {\em mmio\+\_\+num} & Number of MMIO space to access \\
\hline
\mbox{\texttt{ in}}  & {\em offset} & Byte offset into MMIO space \\
\hline
\mbox{\texttt{ out}}  & {\em value} & Pointer to memory where read value is returned (32 bit) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
FPGA\+\_\+\+OK on success. FPGA\+\_\+\+INVALID\+\_\+\+PARAM if any of the supplied parameters is invalid. FPGA\+\_\+\+EXCEPTION if an internal exception occurred while trying to access the handle. 
\end{DoxyReturn}
\mbox{\label{include_2opae_2mmio_8h_a9cf56711df0f234686426c58d8b00cb0}} 
\index{mmio.h@{mmio.h}!fpgaWriteMMIO512@{fpgaWriteMMIO512}}
\index{fpgaWriteMMIO512@{fpgaWriteMMIO512}!mmio.h@{mmio.h}}
\doxysubsubsection{\texorpdfstring{fpgaWriteMMIO512()}{fpgaWriteMMIO512()}}
{\footnotesize\ttfamily \mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} fpga\+Write\+MMIO512 (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}}}]{handle,  }\item[{uint32\+\_\+t}]{mmio\+\_\+num,  }\item[{uint64\+\_\+t}]{offset,  }\item[{const void $\ast$}]{value }\end{DoxyParamCaption})}

Write 512 bit value to MMIO space

512 bit MMIO writes may not be supported on all platforms.

This function will write to MMIO space of the target object at a specified offset.


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em handle} & Handle to previously opened accelerator resource \\
\hline
\mbox{\texttt{ in}}  & {\em mmio\+\_\+num} & Number of MMIO space to access \\
\hline
\mbox{\texttt{ in}}  & {\em offset} & Byte offset into MMIO space \\
\hline
\mbox{\texttt{ in}}  & {\em value} & Pointer to memory holding value to write (512 bits) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
FPGA\+\_\+\+OK on success. FPGA\+\_\+\+INVALID\+\_\+\+PARAM if any of the supplied parameters is invalid. FPGA\+\_\+\+EXCEPTION if an internal exception occurred while trying to access the handle. 
\end{DoxyReturn}
\mbox{\label{include_2opae_2mmio_8h_a2903267d37ea5c64522b0addce74da5f}} 
\index{mmio.h@{mmio.h}!fpgaMapMMIO@{fpgaMapMMIO}}
\index{fpgaMapMMIO@{fpgaMapMMIO}!mmio.h@{mmio.h}}
\doxysubsubsection{\texorpdfstring{fpgaMapMMIO()}{fpgaMapMMIO()}}
{\footnotesize\ttfamily \mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} fpga\+Map\+MMIO (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}}}]{handle,  }\item[{uint32\+\_\+t}]{mmio\+\_\+num,  }\item[{uint64\+\_\+t $\ast$$\ast$}]{mmio\+\_\+ptr }\end{DoxyParamCaption})}

Map MMIO space

This function will return a pointer to the specified MMIO space of the target object in process virtual memory, if supported by the target. Some MMIO spaces may be restricted to privileged processes, depending on the used handle and type.

After mapping the respective MMIO space, you can access it through direct pointer operations (observing supported access sizes and alignments of the target platform and accelerator).

\begin{DoxyNote}{Note}
Some targets (such as the ASE simulator) do not support memory-\/mapping of IO register spaces and will not return a pointer to an actually mapped space. Instead, they will return {\ttfamily FPGA\+\_\+\+NOT\+\_\+\+SUPPORTED}. Usually, these platforms still allow the application to issue MMIO operations using \mbox{\hyperlink{include_2opae_2mmio_8h_a81dc89da3e94e26efff1af1eeebb7f5d}{fpga\+Read\+MMIO32()}}, \mbox{\hyperlink{include_2opae_2mmio_8h_ae538bfe7158d1911c5e749bbc063aa3d}{fpga\+Write\+MMIO32()}}, fpge\+Read\+MMIO64(), and \mbox{\hyperlink{include_2opae_2mmio_8h_a6df7f745d9b9d47582714fe8e2d1a761}{fpga\+Write\+MMIO64()}}.
\end{DoxyNote}
If the caller passes in NULL for mmio\+\_\+ptr, no mapping will be performed, and no virtual address will be returned, though the call will return {\ttfamily FPGA\+\_\+\+OK}. This implies that all accesses will be performed through \mbox{\hyperlink{include_2opae_2mmio_8h_a81dc89da3e94e26efff1af1eeebb7f5d}{fpga\+Read\+MMIO32()}}, \mbox{\hyperlink{include_2opae_2mmio_8h_ae538bfe7158d1911c5e749bbc063aa3d}{fpga\+Write\+MMIO32()}}, fpge\+Read\+MMIO64(), and \mbox{\hyperlink{include_2opae_2mmio_8h_a6df7f745d9b9d47582714fe8e2d1a761}{fpga\+Write\+MMIO64()}}. This is the only supported case for ASE.

The number of available MMIO spaces can be retrieved through the num\+\_\+mmio property (fpga\+Property\+Get\+Num\+MMIO()).


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em handle} & Handle to previously opened resource \\
\hline
\mbox{\texttt{ in}}  & {\em mmio\+\_\+num} & Number of MMIO space to access \\
\hline
\mbox{\texttt{ out}}  & {\em mmio\+\_\+ptr} & Pointer to memory where a pointer to the MMIO space will be returned. May be NULL, in which case no pointer is returned. Returned address may be NULL if underlying platform does not support memory mapping for register access. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
FPGA\+\_\+\+OK on success. FPGA\+\_\+\+INVALID\+\_\+\+PARAM if any of the supplied parameters is invalid. FPGA\+\_\+\+EXCEPTION if an internal exception occurred while trying to access the handle. FPGA\+\_\+\+NO\+\_\+\+ACCESS if the process\textquotesingle{} permissions are not sufficient to map the requested MMIO space. FPGA\+\_\+\+NOT\+\_\+\+SUPPORTED if platform does not support memory mapped IO. 
\end{DoxyReturn}


Referenced by fpga\+\_\+open(), and main().

\mbox{\label{include_2opae_2mmio_8h_a8c8db22506e1fbfd16440c660bfee28f}} 
\index{mmio.h@{mmio.h}!fpgaUnmapMMIO@{fpgaUnmapMMIO}}
\index{fpgaUnmapMMIO@{fpgaUnmapMMIO}!mmio.h@{mmio.h}}
\doxysubsubsection{\texorpdfstring{fpgaUnmapMMIO()}{fpgaUnmapMMIO()}}
{\footnotesize\ttfamily \mbox{\hyperlink{types__enum_8h_a27aaa9bd2d94c9b53602b1a7af49fc6d}{fpga\+\_\+result}} fpga\+Unmap\+MMIO (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{types_8h_a4ad40f31195233b629bcde187b0556d5}{fpga\+\_\+handle}}}]{handle,  }\item[{uint32\+\_\+t}]{mmio\+\_\+num }\end{DoxyParamCaption})}

Unmap MMIO space

This function will unmap a previously mapped MMIO space of the target object, rendering any pointers to it invalid.

\begin{DoxyNote}{Note}
This call is only supported by hardware targets, not by ASE simulation.
\end{DoxyNote}

\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ in}}  & {\em handle} & Handle to previously opened resource \\
\hline
\mbox{\texttt{ in}}  & {\em mmio\+\_\+num} & Number of MMIO space to access \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
FPGA\+\_\+\+OK on success. FPGA\+\_\+\+INVALID\+\_\+\+PARAM if any of the supplied parameters is invalid. FPGA\+\_\+\+EXCEPTION if an internal exception occurred while trying to access the handle. 
\end{DoxyReturn}


Referenced by fpga\+\_\+close(), and main().

