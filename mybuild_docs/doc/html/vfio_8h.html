<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OPAE C API: include/opae/vfio.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OPAE C API
   &#160;<span id="projectnumber">-..</span>
   </div>
   <div id="projectbrief">FPGA API</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_beaf459716867cfd62f7e910a709c36d.html">opae</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">vfio.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>APIs to manage a PCIe device via vfio-pci.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;pthread.h&gt;</code><br />
<code>#include &lt;linux/vfio.h&gt;</code><br />
<code>#include &lt;<a class="el" href="mem__alloc_8h_source.html">opae/mem_alloc.h</a>&gt;</code><br />
<code>#include &lt;<a class="el" href="hash__map_8h_source.html">opae/hash_map.h</a>&gt;</code><br />
</div>
<p><a href="vfio_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structopae__vfio__iova__range"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#structopae__vfio__iova__range">opae_vfio_iova_range</a></td></tr>
<tr class="separator:structopae__vfio__iova__range"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structopae__vfio__group"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#structopae__vfio__group">opae_vfio_group</a></td></tr>
<tr class="separator:structopae__vfio__group"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structopae__vfio__sparse__info"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#structopae__vfio__sparse__info">opae_vfio_sparse_info</a></td></tr>
<tr class="separator:structopae__vfio__sparse__info"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structopae__vfio__device__region"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#structopae__vfio__device__region">opae_vfio_device_region</a></td></tr>
<tr class="separator:structopae__vfio__device__region"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structopae__vfio__device__irq"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#structopae__vfio__device__irq">opae_vfio_device_irq</a></td></tr>
<tr class="separator:structopae__vfio__device__irq"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structopae__vfio__device"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#structopae__vfio__device">opae_vfio_device</a></td></tr>
<tr class="separator:structopae__vfio__device"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structopae__vfio__buffer"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#structopae__vfio__buffer">opae_vfio_buffer</a></td></tr>
<tr class="separator:structopae__vfio__buffer"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structopae__vfio"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a></td></tr>
<tr class="separator:structopae__vfio"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:adea46291b4fdd1878def41704f8acb5c"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#adea46291b4fdd1878def41704f8acb5c">opae_vfio_buffer_flags</a> { <a class="el" href="vfio_8h.html#adea46291b4fdd1878def41704f8acb5ca0ff03bd0152afe6ff864e32e78af2702">OPAE_VFIO_BUF_PREALLOCATED</a> = 1
 }</td></tr>
<tr class="separator:adea46291b4fdd1878def41704f8acb5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a3d3ccbf4a24acbe8f3fc4d973ab46b1a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#a3d3ccbf4a24acbe8f3fc4d973ab46b1a">opae_vfio_open</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v, const char *pciaddr)</td></tr>
<tr class="separator:a3d3ccbf4a24acbe8f3fc4d973ab46b1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d6d1f473a26bc0fbe83e6894b8fb607"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#a8d6d1f473a26bc0fbe83e6894b8fb607">opae_vfio_secure_open</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v, const char *pciaddr, const char *token)</td></tr>
<tr class="separator:a8d6d1f473a26bc0fbe83e6894b8fb607"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afc30450c9b7ebc22709557cac5ab9181"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#afc30450c9b7ebc22709557cac5ab9181">opae_vfio_region_get</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v, uint32_t index, uint8_t **ptr, size_t *size)</td></tr>
<tr class="separator:afc30450c9b7ebc22709557cac5ab9181"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63c468f18994a45604b372c31a1e26cf"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#a63c468f18994a45604b372c31a1e26cf">opae_vfio_buffer_allocate</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v, size_t *size, uint8_t **buf, uint64_t *iova)</td></tr>
<tr class="separator:a63c468f18994a45604b372c31a1e26cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a782b8c30e14075d1c69af9c8e2998578"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#a782b8c30e14075d1c69af9c8e2998578">opae_vfio_buffer_allocate_ex</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v, size_t *size, uint8_t **buf, uint64_t *iova, int flags)</td></tr>
<tr class="separator:a782b8c30e14075d1c69af9c8e2998578"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30f0a317cbcfd12e6918dd11ec4c95f3"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="vfio_8h.html#structopae__vfio__buffer">opae_vfio_buffer</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#a30f0a317cbcfd12e6918dd11ec4c95f3">opae_vfio_buffer_info</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v, uint8_t *vaddr)</td></tr>
<tr class="separator:a30f0a317cbcfd12e6918dd11ec4c95f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae2a60d829698d793ab9a4ad351d2596d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#ae2a60d829698d793ab9a4ad351d2596d">opae_vfio_buffer_free</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v, uint8_t *buf)</td></tr>
<tr class="separator:ae2a60d829698d793ab9a4ad351d2596d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fbe20ee37934b7a6bcebdd648a37191"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#a8fbe20ee37934b7a6bcebdd648a37191">opae_vfio_irq_enable</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v, uint32_t index, uint32_t subindex, int event_fd)</td></tr>
<tr class="separator:a8fbe20ee37934b7a6bcebdd648a37191"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97498e4d858a172906abfded4bce5199"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#a97498e4d858a172906abfded4bce5199">opae_vfio_irq_unmask</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v, uint32_t index, uint32_t subindex)</td></tr>
<tr class="separator:a97498e4d858a172906abfded4bce5199"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94ee809a7040b9bec0a694ca65b0f3f7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#a94ee809a7040b9bec0a694ca65b0f3f7">opae_vfio_irq_mask</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v, uint32_t index, uint32_t subindex)</td></tr>
<tr class="separator:a94ee809a7040b9bec0a694ca65b0f3f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abcce6f91ff59553d5893c4d3632cb87c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#abcce6f91ff59553d5893c4d3632cb87c">opae_vfio_irq_disable</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v, uint32_t index, uint32_t subindex)</td></tr>
<tr class="separator:abcce6f91ff59553d5893c4d3632cb87c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a70fd22e64704c8f0090adb810d51fa83"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="vfio_8h.html#a70fd22e64704c8f0090adb810d51fa83">opae_vfio_close</a> (struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *v)</td></tr>
<tr class="separator:a70fd22e64704c8f0090adb810d51fa83"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>APIs to manage a PCIe device via vfio-pci. </p>
<p>Presents a simple interface for interacting with a PCIe device that is bound to the vfio-pci driver. See <a href="https://kernel.org/doc/Documentation/vfio.txt">https://kernel.org/doc/Documentation/vfio.txt</a> for a description of vfio-pci.</p>
<p>Provides APIs for opening/closing the device, querying info about the MMIO regions of the device, and allocating/mapping and freeing/unmapping DMA buffers. </p>

<p class="definition">Definition in file <a class="el" href="vfio_8h_source.html">vfio.h</a>.</p>
</div><hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structopae__vfio__iova__range" id="structopae__vfio__iova__range"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structopae__vfio__iova__range">&#9670;&nbsp;</a></span>opae_vfio_iova_range</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct opae_vfio_iova_range</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>IO Virtual Address Range</p>
<p>A range of allocatable IOVA offsets. Used for mapping DMA buffers. </p>

<p class="definition">Definition at line <a class="el" href="vfio_8h_source.html#l00057">57</a> of file <a class="el" href="vfio_8h_source.html">vfio.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="ae44d6d78fc59fec1829117f80f09d676"></a>uint64_t</td>
<td class="fieldname">
start</td>
<td class="fielddoc">
<p>Start of this range of offsets. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a8e09837d655b7187d704d1dec69bd3e2"></a>uint64_t</td>
<td class="fieldname">
end</td>
<td class="fielddoc">
<p>End of this range of offsets. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="acdadb8bd4497fd424a045de13f1c0570"></a>struct <a class="el" href="vfio_8h.html#structopae__vfio__iova__range">opae_vfio_iova_range</a> *</td>
<td class="fieldname">
next</td>
<td class="fielddoc">
<p>Pointer to next in list. </p>
</td></tr>
</table>

</div>
</div>
<a name="structopae__vfio__group" id="structopae__vfio__group"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structopae__vfio__group">&#9670;&nbsp;</a></span>opae_vfio_group</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct opae_vfio_group</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>VFIO group</p>
<p>Each device managed by vfio-pci belongs to a VFIO group rooted at /dev/vfio/N, where N is the group number. </p>

<p class="definition">Definition at line <a class="el" href="vfio_8h_source.html#l00069">69</a> of file <a class="el" href="vfio_8h_source.html">vfio.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="aa7f7d7923d85bdb630b0b1ec49be5f92"></a>char *</td>
<td class="fieldname">
group_device</td>
<td class="fielddoc">
<p>Full path to the group device. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a51d7ad18b5d27f7713877bc9e7f31c92"></a>int</td>
<td class="fieldname">
group_fd</td>
<td class="fielddoc">
<p>File descriptor for the group device. </p>
</td></tr>
</table>

</div>
</div>
<a name="structopae__vfio__sparse__info" id="structopae__vfio__sparse__info"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structopae__vfio__sparse__info">&#9670;&nbsp;</a></span>opae_vfio_sparse_info</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct opae_vfio_sparse_info</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>MMIO sparse-mappable region info</p>
<p>Describes a range of sparse-mappable MMIO, for MMIO ranges that have non-contiguous addresses. </p>

<p class="definition">Definition at line <a class="el" href="vfio_8h_source.html#l00080">80</a> of file <a class="el" href="vfio_8h_source.html">vfio.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a0f2a85a947a552ace76e299bd66dc91d"></a>uint32_t</td>
<td class="fieldname">
index</td>
<td class="fielddoc">
<p>Region index, from 0. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="afc2d2ce14bb3aeaba49efa5e8a063dfb"></a>uint32_t</td>
<td class="fieldname">
offset</td>
<td class="fielddoc">
<p>Offset of sparse region. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="adefec9a427d225b75b9b272710174df8"></a>uint32_t</td>
<td class="fieldname">
size</td>
<td class="fielddoc">
<p>Size of sparse region. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a68ad8ff776b8b47536d8f515eadffaa4"></a>uint8_t *</td>
<td class="fieldname">
ptr</td>
<td class="fielddoc">
<p>Virtual address of sparse region. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a6557e0f64b5cb7f9e89218aaa535d583"></a>struct <a class="el" href="vfio_8h.html#structopae__vfio__sparse__info">opae_vfio_sparse_info</a> *</td>
<td class="fieldname">
next</td>
<td class="fielddoc">
<p>Pointer to next in list. </p>
</td></tr>
</table>

</div>
</div>
<a name="structopae__vfio__device__region" id="structopae__vfio__device__region"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structopae__vfio__device__region">&#9670;&nbsp;</a></span>opae_vfio_device_region</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct opae_vfio_device_region</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>MMIO region info</p>
<p>Describes a range of mappable MMIO. </p>

<p class="definition">Definition at line <a class="el" href="vfio_8h_source.html#l00093">93</a> of file <a class="el" href="vfio_8h_source.html">vfio.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a276412974a0b0ffb91ac3200149761b0"></a>uint32_t</td>
<td class="fieldname">
region_index</td>
<td class="fielddoc">
<p>Region index, from 0. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a37bbecd990a16e1d985bece6d8395e86"></a>uint8_t *</td>
<td class="fieldname">
region_ptr</td>
<td class="fielddoc">
<p>Virtual address of region. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="add69a93ef216ab2ed1a053f506605f8e"></a>size_t</td>
<td class="fieldname">
region_size</td>
<td class="fielddoc">
<p>Size of region. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a52a91a9da49e5a61dbb5e8f511733aba"></a>struct <a class="el" href="vfio_8h.html#structopae__vfio__sparse__info">opae_vfio_sparse_info</a> *</td>
<td class="fieldname">
region_sparse</td>
<td class="fielddoc">
<p>For sparse regions. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="ad58eb4a337da7515de0acca200a2463c"></a>struct <a class="el" href="vfio_8h.html#structopae__vfio__device__region">opae_vfio_device_region</a> *</td>
<td class="fieldname">
next</td>
<td class="fielddoc">
<p>Pointer to next in list. </p>
</td></tr>
</table>

</div>
</div>
<a name="structopae__vfio__device__irq" id="structopae__vfio__device__irq"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structopae__vfio__device__irq">&#9670;&nbsp;</a></span>opae_vfio_device_irq</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct opae_vfio_device_irq</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Interrupt info</p>
<p>Describes an interrupt capability. </p>

<p class="definition">Definition at line <a class="el" href="vfio_8h_source.html#l00106">106</a> of file <a class="el" href="vfio_8h_source.html">vfio.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a8a7ea1141298b55129019cc8e1672bb9"></a>uint32_t</td>
<td class="fieldname">
flags</td>
<td class="fielddoc">
<p>Flags. See struct vfio_irq_info. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="ae80f357cdeaa6c6e20031cedcaad5712"></a>uint32_t</td>
<td class="fieldname">
index</td>
<td class="fielddoc">
<p>The IRQ index. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="ae8531b9a37c51672f1e8693a8473cad2"></a>uint32_t</td>
<td class="fieldname">
count</td>
<td class="fielddoc">
<p>Number of IRQs at this index. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a066566f8808335166498fbce4d8a5211"></a>int32_t *</td>
<td class="fieldname">
event_fds</td>
<td class="fielddoc">
<p>Event file descriptors. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a59f2bf38b7882ff09232e83ba7dea984"></a>int32_t *</td>
<td class="fieldname">
masks</td>
<td class="fielddoc">
<p>IRQ masks. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a80db0fd825bd3d7b73c4a70b86be60b5"></a>struct <a class="el" href="vfio_8h.html#structopae__vfio__device__irq">opae_vfio_device_irq</a> *</td>
<td class="fieldname">
next</td>
<td class="fielddoc">
<p>Pointer to next in list. </p>
</td></tr>
</table>

</div>
</div>
<a name="structopae__vfio__device" id="structopae__vfio__device"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structopae__vfio__device">&#9670;&nbsp;</a></span>opae_vfio_device</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct opae_vfio_device</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>VFIO device</p>
<p>Each VFIO device has a file descriptor that is used to query information about the device MMIO regions and config space. </p>

<p class="definition">Definition at line <a class="el" href="vfio_8h_source.html#l00121">121</a> of file <a class="el" href="vfio_8h_source.html">vfio.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a5567cac847af54d1b68cd11de6d9071a"></a>int</td>
<td class="fieldname">
device_fd</td>
<td class="fielddoc">
<p>Device file descriptor. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a484988f748aa324957a2046bc2590e10"></a>uint64_t</td>
<td class="fieldname">
device_config_offset</td>
<td class="fielddoc">
<p>Offset of PCIe config space. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="ad9ca3ae45cd69d3eec04297820c98db4"></a>uint32_t</td>
<td class="fieldname">
device_num_regions</td>
<td class="fielddoc">
<p>Total MMIO region count. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="ab45bac066081e611b23ff38c90ab6f26"></a>struct <a class="el" href="vfio_8h.html#structopae__vfio__device__region">opae_vfio_device_region</a> *</td>
<td class="fieldname">
regions</td>
<td class="fielddoc">
<p>Region list pointer. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="ad4fc938dbf2c96ea60222912b4ed72ca"></a>uint32_t</td>
<td class="fieldname">
device_num_irqs</td>
<td class="fielddoc">
<p>IRQ index count. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a491523e147d7ae93d48b49d713bdce7c"></a>struct <a class="el" href="vfio_8h.html#structopae__vfio__device__irq">opae_vfio_device_irq</a> *</td>
<td class="fieldname">
irqs</td>
<td class="fielddoc">
<p>IRQ list pointer. </p>
</td></tr>
</table>

</div>
</div>
<a name="structopae__vfio__buffer" id="structopae__vfio__buffer"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structopae__vfio__buffer">&#9670;&nbsp;</a></span>opae_vfio_buffer</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct opae_vfio_buffer</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>System DMA buffer</p>
<p>Describes a system memory address space that is capable of DMA. </p>

<p class="definition">Definition at line <a class="el" href="vfio_8h_source.html#l00135">135</a> of file <a class="el" href="vfio_8h_source.html">vfio.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a10c301384270143e76d93675740d2a05"></a>uint8_t *</td>
<td class="fieldname">
buffer_ptr</td>
<td class="fielddoc">
<p>Buffer virtual address. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a52535a9a9d8c7a129fb313d14a96dc47"></a>size_t</td>
<td class="fieldname">
buffer_size</td>
<td class="fielddoc">
<p>Buffer size. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a4bccc7115924108b58c421955a6b9775"></a>uint64_t</td>
<td class="fieldname">
buffer_iova</td>
<td class="fielddoc">
<p>Buffer IOVA address. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a9e334d32ec820b06a9d263bc158da2ed"></a>int</td>
<td class="fieldname">
flags</td>
<td class="fielddoc">
<p>See opae_vfio_buffer_flags. </p>
</td></tr>
</table>

</div>
</div>
<a name="structopae__vfio" id="structopae__vfio"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structopae__vfio">&#9670;&nbsp;</a></span>opae_vfio</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct opae_vfio</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>OPAE VFIO device abstraction</p>
<p>This structure is used to interact with the OPAE VFIO API. It tracks data related to the VFIO container, group, and device. A mutex is provided for thread safety. </p>

<p class="definition">Definition at line <a class="el" href="vfio_8h_source.html#l00149">149</a> of file <a class="el" href="vfio_8h_source.html">vfio.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="ad9ef4790801de907acfa18409dedfaab"></a>pthread_mutex_t</td>
<td class="fieldname">
lock</td>
<td class="fielddoc">
<p>For thread safety. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a7ca65a6a199f57795216b4af7e152b7e"></a>char *</td>
<td class="fieldname">
cont_device</td>
<td class="fielddoc">
<p>"/dev/vfio/vfio" </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a12cbdd053863723e3b51564dab3b1de5"></a>char *</td>
<td class="fieldname">
cont_pciaddr</td>
<td class="fielddoc">
<p>PCIe address, eg 0000:00:00.0 </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a7cdb7430f296c4c469dc54f075014245"></a>int</td>
<td class="fieldname">
cont_fd</td>
<td class="fielddoc">
<p>Container file descriptor. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a65cb87d5caf739177f1627f369704ea4"></a>struct <a class="el" href="vfio_8h.html#structopae__vfio__iova__range">opae_vfio_iova_range</a> *</td>
<td class="fieldname">
cont_ranges</td>
<td class="fielddoc">
<p>List of IOVA ranges. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a27de65bf440333362258d9da72fb93d7"></a>struct <a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a></td>
<td class="fieldname">
iova_alloc</td>
<td class="fielddoc">
<p>Allocator for IOVA space. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a5aa9019a215689bb45c6de05425489e0"></a>struct <a class="el" href="vfio_8h.html#structopae__vfio__group">opae_vfio_group</a></td>
<td class="fieldname">
group</td>
<td class="fielddoc">
<p>The VFIO device group. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a0321bdb1c77dad0ad3f57d32d5f00de6"></a>struct <a class="el" href="vfio_8h.html#structopae__vfio__device">opae_vfio_device</a></td>
<td class="fieldname">
device</td>
<td class="fielddoc">
<p>The VFIO device. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="a421b8a46f5c5bca0d663f415f567dc19"></a><a class="el" href="structopae__hash__map.html">opae_hash_map</a></td>
<td class="fieldname">
cont_buffers</td>
<td class="fielddoc">
<p>Map of allocated DMA buffers. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="adea46291b4fdd1878def41704f8acb5c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adea46291b4fdd1878def41704f8acb5c">&#9670;&nbsp;</a></span>opae_vfio_buffer_flags</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="vfio_8h.html#adea46291b4fdd1878def41704f8acb5c">opae_vfio_buffer_flags</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Flags for <a class="el" href="vfio_8h.html#a782b8c30e14075d1c69af9c8e2998578">opae_vfio_buffer_allocate_ex()</a>. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="adea46291b4fdd1878def41704f8acb5ca0ff03bd0152afe6ff864e32e78af2702"></a>OPAE_VFIO_BUF_PREALLOCATED&#160;</td><td class="fielddoc"><p>Use existing buffer </p>
</td></tr>
</table>

<p class="definition">Definition at line <a class="el" href="vfio_8h_source.html#l00340">340</a> of file <a class="el" href="vfio_8h_source.html">vfio.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a3d3ccbf4a24acbe8f3fc4d973ab46b1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3d3ccbf4a24acbe8f3fc4d973ab46b1a">&#9670;&nbsp;</a></span>opae_vfio_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opae_vfio_open </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pciaddr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Open and populate a VFIO device</p>
<p>Opens the PCIe device corresponding to the address given in pciaddr. The device must be bound to the vfio-pci driver prior to opening it. The data structures corresponding to IOVA space, MMIO regions, and DMA buffers are initialized.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">v</td><td>Storage for the device info. May be stack-resident. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pciaddr</td><td>The PCIe address of the requested device. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success.</dd></dl>
<p>Example </p><div class="fragment"><div class="line">$ sudo opaevfio -i 0000:00:00.0 -u user -g group</div>
</div><!-- fragment --><p>Example </p><div class="fragment"><div class="line"><a class="code" href="vfio_8h.html#structopae__vfio">opae_vfio</a> v;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="vfio_8h.html#a3d3ccbf4a24acbe8f3fc4d973ab46b1a">opae_vfio_open</a>(&amp;v, <span class="stringliteral">&quot;0000:00:00.0&quot;</span>)) {</div>
<div class="line">  <span class="comment">// handle error</span></div>
<div class="line">}</div>
<div class="ttc" id="avfio_8h_html_a3d3ccbf4a24acbe8f3fc4d973ab46b1a"><div class="ttname"><a href="vfio_8h.html#a3d3ccbf4a24acbe8f3fc4d973ab46b1a">opae_vfio_open</a></div><div class="ttdeci">int opae_vfio_open(struct opae_vfio *v, const char *pciaddr)</div></div>
<div class="ttc" id="avfio_8h_html_structopae__vfio"><div class="ttname"><a href="vfio_8h.html#structopae__vfio">opae_vfio</a></div><div class="ttdef"><b>Definition:</b> <a href="vfio_8h_source.html#l00149">vfio.h:149</a></div></div>
</div><!-- fragment --> 
</div>
</div>
<a id="a8d6d1f473a26bc0fbe83e6894b8fb607"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d6d1f473a26bc0fbe83e6894b8fb607">&#9670;&nbsp;</a></span>opae_vfio_secure_open()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opae_vfio_secure_open </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>pciaddr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>token</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Open and populate a VFIO device</p>
<p>Opens the PCIe device corresponding to the address given in pciaddr, using the VF token (GUID) given in token. The device must be bound to the vfio-pci driver prior to opening it. The data structures corresponding to IOVA space, MMIO regions, and DMA buffers are initialized.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">v</td><td>Storage for the device info. May be stack-resident. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">pciaddr</td><td>The PCIe address of the requested device. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">token</td><td>The GUID representing the VF token. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success.</dd></dl>
<p>Example </p><div class="fragment"><div class="line">$ sudo opaevfio -i 0000:00:00.0 -u user -g group</div>
</div><!-- fragment --><p>Example </p><div class="fragment"><div class="line"><a class="code" href="vfio_8h.html#structopae__vfio">opae_vfio</a> v;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="vfio_8h.html#a8d6d1f473a26bc0fbe83e6894b8fb607">opae_vfio_secure_open</a>(&amp;v, <span class="stringliteral">&quot;0000:00:00.0&quot;</span>,</div>
<div class="line">                          <span class="stringliteral">&quot;00f5ad6b-2edd-422e-9d1e-34124c686fec&quot;</span>)) {</div>
<div class="line">  <span class="comment">// handle error</span></div>
<div class="line">}</div>
<div class="ttc" id="avfio_8h_html_a8d6d1f473a26bc0fbe83e6894b8fb607"><div class="ttname"><a href="vfio_8h.html#a8d6d1f473a26bc0fbe83e6894b8fb607">opae_vfio_secure_open</a></div><div class="ttdeci">int opae_vfio_secure_open(struct opae_vfio *v, const char *pciaddr, const char *token)</div></div>
</div><!-- fragment --> 
</div>
</div>
<a id="afc30450c9b7ebc22709557cac5ab9181"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afc30450c9b7ebc22709557cac5ab9181">&#9670;&nbsp;</a></span>opae_vfio_region_get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opae_vfio_region_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t **&#160;</td>
          <td class="paramname"><em>ptr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Query device MMIO region</p>
<p>Retrieves info describing the MMIO region with the given region index. The device structure v must have been previously opened by a call to opae_vfio_open.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>The open OPAE VFIO device. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">index</td><td>The zero-based index of the desired MMIO region. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">ptr</td><td>Optional pointer to receive the virtual address for the region. Pass NULL to ignore. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">size</td><td>Optional pointer to receive the size of the MMIO region. Pass NULL to ignore. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error (including index out-of-range). Zero on success.</dd></dl>
<p>Example </p><div class="fragment"><div class="line"><a class="code" href="vfio_8h.html#structopae__vfio">opae_vfio</a> v;</div>
<div class="line"> </div>
<div class="line">uint8_t *fme_virt = NULL;</div>
<div class="line">uint8_t *port_virt = NULL;</div>
<div class="line"><span class="keywordtype">size_t</span> fme_size = 0;</div>
<div class="line"><span class="keywordtype">size_t</span> port_size = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="vfio_8h.html#a3d3ccbf4a24acbe8f3fc4d973ab46b1a">opae_vfio_open</a>(&amp;v, <span class="stringliteral">&quot;0000:00:00.0&quot;</span>)) {</div>
<div class="line">  <span class="comment">// handle error</span></div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">  <a class="code" href="vfio_8h.html#afc30450c9b7ebc22709557cac5ab9181">opae_vfio_region_get</a>(&amp;v, 0, &amp;fme_virt, &amp;fme_size);</div>
<div class="line">  <a class="code" href="vfio_8h.html#afc30450c9b7ebc22709557cac5ab9181">opae_vfio_region_get</a>(&amp;v, 2, &amp;port_virt, &amp;port_size);</div>
<div class="line">}</div>
<div class="ttc" id="avfio_8h_html_afc30450c9b7ebc22709557cac5ab9181"><div class="ttname"><a href="vfio_8h.html#afc30450c9b7ebc22709557cac5ab9181">opae_vfio_region_get</a></div><div class="ttdeci">int opae_vfio_region_get(struct opae_vfio *v, uint32_t index, uint8_t **ptr, size_t *size)</div></div>
</div><!-- fragment --> 
</div>
</div>
<a id="a63c468f18994a45604b372c31a1e26cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a63c468f18994a45604b372c31a1e26cf">&#9670;&nbsp;</a></span>opae_vfio_buffer_allocate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opae_vfio_buffer_allocate </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t **&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>iova</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and map system buffer</p>
<p>Allocate, map, and retrieve info for a system buffer capable of DMA. Saves an entry in the v-&gt;cont_buffers list. If the buffer is not explicitly freed by opae_vfio_buffer_free, it will be freed during opae_vfio_close.</p>
<p>mmap is used for the allocation. If the size is greater than 2MB, then the allocation request is fulfilled by a 1GB huge page. Else, if the size is greater than 4096, then the request is fulfilled by a 2MB huge page. Else, the request is fulfilled by the non-huge page pool.</p>
<dl class="section note"><dt>Note</dt><dd>Allocations from the huge page pool require that huge pages be configured on the system. Huge pages may be configured on the kernel boot command prompt. Example default_hugepagesz=1G hugepagesz=1G hugepages=2 hugepagesz=2M hugepages=8</dd>
<dd>
Huge pages may also be configured at runtime. Example sudo sh -c 'echo 8 &gt; /sys/kernel/mm/hugepages/hugepages-2048kB/nr_hugepages' sudo sh -c 'echo 2 &gt; /sys/kernel/mm/hugepages/hugepages-1048576kB/nr_hugepages'</dd>
<dd>
Be sure that the IOMMU is also enabled using the follow kernel boot command: intel_iommu=on</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>The open OPAE VFIO device. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">size</td><td>A pointer to the requested size. The size may be rounded to the next page size prior to return from the function. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>Optional pointer to receive the virtual address for the buffer. Pass NULL to ignore. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">iova</td><td>Optional pointer to receive the IOVA address for the buffer. Pass NULL to ignore. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success.</dd></dl>
<p>Example </p><div class="fragment"><div class="line"><a class="code" href="vfio_8h.html#structopae__vfio">opae_vfio</a> v;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">size_t</span> sz;</div>
<div class="line">uint8_t *buf_2m_virt = NULL;</div>
<div class="line">uint8_t *buf_1g_virt = NULL;</div>
<div class="line">uint64_t buf_2m_iova = 0;</div>
<div class="line">uint64_t buf_1g_iova = 0;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="vfio_8h.html#a3d3ccbf4a24acbe8f3fc4d973ab46b1a">opae_vfio_open</a>(&amp;v, <span class="stringliteral">&quot;0000:00:00.0&quot;</span>)) {</div>
<div class="line">  <span class="comment">// handle error</span></div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">  sz = 2 * 1024 * 1024;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="vfio_8h.html#a63c468f18994a45604b372c31a1e26cf">opae_vfio_buffer_allocate</a>(&amp;v,</div>
<div class="line">                                &amp;sz,</div>
<div class="line">                                &amp;buf_2m_virt,</div>
<div class="line">                                &amp;buf_2m_iova)) {</div>
<div class="line">    <span class="comment">// handle allocation error</span></div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  sz = 1024 * 1024 * 1024;</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="vfio_8h.html#a63c468f18994a45604b372c31a1e26cf">opae_vfio_buffer_allocate</a>(&amp;v,</div>
<div class="line">                                &amp;sz,</div>
<div class="line">                                &amp;buf_1g_virt,</div>
<div class="line">                                &amp;buf_1g_iova)) {</div>
<div class="line">    <span class="comment">// handle allocation error</span></div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="avfio_8h_html_a63c468f18994a45604b372c31a1e26cf"><div class="ttname"><a href="vfio_8h.html#a63c468f18994a45604b372c31a1e26cf">opae_vfio_buffer_allocate</a></div><div class="ttdeci">int opae_vfio_buffer_allocate(struct opae_vfio *v, size_t *size, uint8_t **buf, uint64_t *iova)</div></div>
</div><!-- fragment --> 
</div>
</div>
<a id="a782b8c30e14075d1c69af9c8e2998578"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a782b8c30e14075d1c69af9c8e2998578">&#9670;&nbsp;</a></span>opae_vfio_buffer_allocate_ex()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opae_vfio_buffer_allocate_ex </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t **&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>iova</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>flags</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate and map system buffer (extended w/ flags)</p>
<p>Allocate, map, and retrieve info for a system buffer capable of DMA. Saves an entry in the v-&gt;cont_buffers list. If the buffer is not explicitly freed by opae_vfio_buffer_free, it will be freed during opae_vfio_close, unless OPAE_VFIO_BUF_PREALLOCATED is used in which case the buffer is not freed by this library.</p>
<p>When not using OPAE_VFIO_BUF_PREALLOCATED, mmap is used for the allocation. If the size is greater than 2MB, then the allocation request is fulfilled by a 1GB huge page. Else, if the size is greater than 4096, then the request is fulfilled by a 2MB huge page. Else, the request is fulfilled by the non-huge page pool.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>The open OPAE VFIO device. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">size</td><td>A pointer to the requested size. The size may be rounded to the next page size prior to return from the function. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">buf</td><td>Optional pointer to receive the virtual address for the buffer/input buffer pointer when using OPAE_VFIO_BUF_PREALLOCATED. Pass NULL to ignore. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">iova</td><td>Optional pointer to receive the IOVA address for the buffer. Pass NULL to ignore. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success.</dd></dl>
<p>Example </p><div class="fragment"><div class="line"><a class="code" href="vfio_8h.html#structopae__vfio">opae_vfio</a> v;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">size_t</span> sz = MY_BUF_SIZE;</div>
<div class="line">uint8_t *prealloc_virt = NULL;</div>
<div class="line">uint64_t iova = 0;</div>
<div class="line"> </div>
<div class="line">prealloc_virt = allocate_my_buffer(sz);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="vfio_8h.html#a3d3ccbf4a24acbe8f3fc4d973ab46b1a">opae_vfio_open</a>(&amp;v, <span class="stringliteral">&quot;0000:00:00.0&quot;</span>)) {</div>
<div class="line">  <span class="comment">// handle error</span></div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="vfio_8h.html#a782b8c30e14075d1c69af9c8e2998578">opae_vfio_buffer_allocate_ex</a>(&amp;v,</div>
<div class="line">                                   &amp;sz,</div>
<div class="line">                                   &amp;prealloc_virt,</div>
<div class="line">                                   &amp;iova,</div>
<div class="line">                                   <a class="code" href="vfio_8h.html#adea46291b4fdd1878def41704f8acb5ca0ff03bd0152afe6ff864e32e78af2702">OPAE_VFIO_BUF_PREALLOCATED</a>)) {</div>
<div class="line">    <span class="comment">// handle allocation error</span></div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="avfio_8h_html_a782b8c30e14075d1c69af9c8e2998578"><div class="ttname"><a href="vfio_8h.html#a782b8c30e14075d1c69af9c8e2998578">opae_vfio_buffer_allocate_ex</a></div><div class="ttdeci">int opae_vfio_buffer_allocate_ex(struct opae_vfio *v, size_t *size, uint8_t **buf, uint64_t *iova, int flags)</div></div>
<div class="ttc" id="avfio_8h_html_adea46291b4fdd1878def41704f8acb5ca0ff03bd0152afe6ff864e32e78af2702"><div class="ttname"><a href="vfio_8h.html#adea46291b4fdd1878def41704f8acb5ca0ff03bd0152afe6ff864e32e78af2702">OPAE_VFIO_BUF_PREALLOCATED</a></div><div class="ttdeci">@ OPAE_VFIO_BUF_PREALLOCATED</div><div class="ttdef"><b>Definition:</b> <a href="vfio_8h_source.html#l00341">vfio.h:341</a></div></div>
</div><!-- fragment --> 
</div>
</div>
<a id="a30f0a317cbcfd12e6918dd11ec4c95f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30f0a317cbcfd12e6918dd11ec4c95f3">&#9670;&nbsp;</a></span>opae_vfio_buffer_info()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="vfio_8h.html#structopae__vfio__buffer">opae_vfio_buffer</a>* opae_vfio_buffer_info </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>vaddr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Extract the internal data structure pointer for the given vaddr</p>
<p>The virtual address vaddr must correspond to a buffer previously allocated by <a class="el" href="vfio_8h.html#a63c468f18994a45604b372c31a1e26cf">opae_vfio_buffer_allocate()</a> or <a class="el" href="vfio_8h.html#a782b8c30e14075d1c69af9c8e2998578">opae_vfio_buffer_allocate_ex()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>The open OPAE VFIO device. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">vaddr</td><td>The user virtual address of the desired buffer info struct. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>NULL on lookup error. </dd></dl>

</div>
</div>
<a id="ae2a60d829698d793ab9a4ad351d2596d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae2a60d829698d793ab9a4ad351d2596d">&#9670;&nbsp;</a></span>opae_vfio_buffer_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opae_vfio_buffer_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t *&#160;</td>
          <td class="paramname"><em>buf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unmap and free a system buffer</p>
<p>The buffer corresponding to buf must have been created by a previous call to opae_vfio_buffer_allocate.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>The open OPAE VFIO device. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buf</td><td>The virtual address corresponding to the buffer to be freed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success.</dd></dl>
<p>Example </p><div class="fragment"><div class="line"><span class="keywordtype">size_t</span> sz;</div>
<div class="line">uint8_t *buf_2m_virt = NULL;</div>
<div class="line">uint64_t buf_2m_iova = 0;</div>
<div class="line"> </div>
<div class="line">sz = 2 * 1024 * 1024;</div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="vfio_8h.html#a63c468f18994a45604b372c31a1e26cf">opae_vfio_buffer_allocate</a>(&amp;v,</div>
<div class="line">                              &amp;sz,</div>
<div class="line">                              &amp;buf_2m_virt,</div>
<div class="line">                              &amp;buf_2m_iova)) {</div>
<div class="line">  <span class="comment">// handle allocation error</span></div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">  <span class="comment">// use the buffer</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (<a class="code" href="vfio_8h.html#ae2a60d829698d793ab9a4ad351d2596d">opae_vfio_buffer_free</a>(&amp;v, buf_2m_virt)) {</div>
<div class="line">    <span class="comment">// handle free error</span></div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="ttc" id="avfio_8h_html_ae2a60d829698d793ab9a4ad351d2596d"><div class="ttname"><a href="vfio_8h.html#ae2a60d829698d793ab9a4ad351d2596d">opae_vfio_buffer_free</a></div><div class="ttdeci">int opae_vfio_buffer_free(struct opae_vfio *v, uint8_t *buf)</div></div>
</div><!-- fragment --> 
</div>
</div>
<a id="a8fbe20ee37934b7a6bcebdd648a37191"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8fbe20ee37934b7a6bcebdd648a37191">&#9670;&nbsp;</a></span>opae_vfio_irq_enable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opae_vfio_irq_enable </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>subindex</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>event_fd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enable an IRQ</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>The open OPAE VFIO device. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">index</td><td>The IRQ category. For MSI-X, use VFIO_PCI_MSIX_IRQ_INDEX. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">subindex</td><td>The IRQ to enable. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">event_fd</td><td>The file descriptor, created by eventfd(). Interrupts will result in this event_fd being signaled. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success. </dd></dl>

</div>
</div>
<a id="a97498e4d858a172906abfded4bce5199"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a97498e4d858a172906abfded4bce5199">&#9670;&nbsp;</a></span>opae_vfio_irq_unmask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opae_vfio_irq_unmask </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>subindex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Unmask an IRQ</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>The open OPAE VFIO device. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">index</td><td>The IRQ category. For MSI-X, use VFIO_PCI_MSIX_IRQ_INDEX. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">subindex</td><td>The IRQ to unmask. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success. </dd></dl>

</div>
</div>
<a id="a94ee809a7040b9bec0a694ca65b0f3f7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94ee809a7040b9bec0a694ca65b0f3f7">&#9670;&nbsp;</a></span>opae_vfio_irq_mask()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opae_vfio_irq_mask </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>subindex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Mask an IRQ</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>The open OPAE VFIO device. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">index</td><td>The IRQ category. For MSI-X, use VFIO_PCI_MSIX_IRQ_INDEX. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">subindex</td><td>The IRQ to mask. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success. </dd></dl>

</div>
</div>
<a id="abcce6f91ff59553d5893c4d3632cb87c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abcce6f91ff59553d5893c4d3632cb87c">&#9670;&nbsp;</a></span>opae_vfio_irq_disable()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int opae_vfio_irq_disable </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>subindex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Disable an IRQ</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">v</td><td>The open OPAE VFIO device. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">index</td><td>The IRQ category. For MSI-X, use VFIO_PCI_MSIX_IRQ_INDEX. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">subindex</td><td>The IRQ to disable. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success. </dd></dl>

</div>
</div>
<a id="a70fd22e64704c8f0090adb810d51fa83"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a70fd22e64704c8f0090adb810d51fa83">&#9670;&nbsp;</a></span>opae_vfio_close()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void opae_vfio_close </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="vfio_8h.html#structopae__vfio">opae_vfio</a> *&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Release and close a VFIO device</p>
<p>The given device pointer must have been previously initialized by opae_vfio_open. Releases all data structures, including any DMA buffer allocations that have not be explicitly freed by opae_vfio_buffer_free.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">v</td><td>Storage for the device info. May be stack-resident.</td></tr>
  </table>
  </dd>
</dl>
<p>Example </p><div class="fragment"><div class="line"><a class="code" href="vfio_8h.html#structopae__vfio">opae_vfio</a> v;</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="vfio_8h.html#a3d3ccbf4a24acbe8f3fc4d973ab46b1a">opae_vfio_open</a>(&amp;v, <span class="stringliteral">&quot;0000:00:00.0&quot;</span>)) {</div>
<div class="line">  <span class="comment">// handle error</span></div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">  <span class="comment">// interact with the device</span></div>
<div class="line">  ...</div>
<div class="line">  <span class="comment">// free the device</span></div>
<div class="line">  <a class="code" href="vfio_8h.html#a70fd22e64704c8f0090adb810d51fa83">opae_vfio_close</a>(&amp;v);</div>
<div class="line">}</div>
<div class="ttc" id="avfio_8h_html_a70fd22e64704c8f0090adb810d51fa83"><div class="ttname"><a href="vfio_8h.html#a70fd22e64704c8f0090adb810d51fa83">opae_vfio_close</a></div><div class="ttdeci">void opae_vfio_close(struct opae_vfio *v)</div></div>
</div><!-- fragment --><p>Example </p><div class="fragment"><div class="line">$ sudo opaevfio -r 0000:00:00.0</div>
</div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
