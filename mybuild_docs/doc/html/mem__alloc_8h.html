<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>OPAE C API: include/opae/mem_alloc.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">OPAE C API
   &#160;<span id="projectnumber">-..</span>
   </div>
   <div id="projectbrief">FPGA API</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li><li class="navelem"><a class="el" href="dir_beaf459716867cfd62f7e910a709c36d.html">opae</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">mem_alloc.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
</div>
<p><a href="mem__alloc_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structmem__link"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__alloc_8h.html#structmem__link">mem_link</a></td></tr>
<tr class="separator:structmem__link"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structmem__alloc"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a></td></tr>
<tr class="separator:structmem__alloc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ac37e826046364bcbc938be357d088dda"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__alloc_8h.html#ac37e826046364bcbc938be357d088dda">mem_alloc_init</a> (struct <a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> *m)</td></tr>
<tr class="separator:ac37e826046364bcbc938be357d088dda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af51e1559cd8eb3aa3cc0c433fcfcaa71"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__alloc_8h.html#af51e1559cd8eb3aa3cc0c433fcfcaa71">mem_alloc_destroy</a> (struct <a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> *m)</td></tr>
<tr class="separator:af51e1559cd8eb3aa3cc0c433fcfcaa71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:affae27295ea2cd566c06dba6fb34835f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__alloc_8h.html#affae27295ea2cd566c06dba6fb34835f">mem_alloc_add_free</a> (struct <a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> *m, uint64_t address, uint64_t size)</td></tr>
<tr class="separator:affae27295ea2cd566c06dba6fb34835f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdb4e638fb73f1199f739bdd4cad9b16"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__alloc_8h.html#afdb4e638fb73f1199f739bdd4cad9b16">mem_alloc_get</a> (struct <a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> *m, uint64_t *address, uint64_t size)</td></tr>
<tr class="separator:afdb4e638fb73f1199f739bdd4cad9b16"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7f633432ea4eea5c671b37645a7270a4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__alloc_8h.html#a7f633432ea4eea5c671b37645a7270a4">mem_alloc_put</a> (struct <a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> *m, uint64_t address)</td></tr>
<tr class="separator:a7f633432ea4eea5c671b37645a7270a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structmem__link" id="structmem__link"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structmem__link">&#9670;&nbsp;</a></span>mem_link</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct mem_link</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p>Provides an API for allocating/freeing a logical address space. There is no interaction with any OS memory allocation infrastructure, whether malloc, mmap, etc. The "address ranges" tracked by this allocator are arbitrary 64-bit integers. The allocator simply provides the bookeeping logic that ensures that a unique address with the appropriate size is returned for each allocation request, and that an allocation can be freed, ie released back to the available pool of logical address space for future allocations. The memory backing the allocator's internal data structures is managed by malloc()/free(). </p>

<p class="definition">Definition at line <a class="el" href="mem__alloc_8h_source.html#l00043">43</a> of file <a class="el" href="mem__alloc_8h_source.html">mem_alloc.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a4c968ceba2b3fd177cf209d5157b9cb6"></a>uint64_t</td>
<td class="fieldname">
address</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a id="ac99991a999b487d1a7afa70c3f9aadcf"></a>uint64_t</td>
<td class="fieldname">
size</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a id="a1225e65e5841948cc0b81c533cfeaab7"></a>struct <a class="el" href="mem__alloc_8h.html#structmem__link">mem_link</a> *</td>
<td class="fieldname">
prev</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a id="a0b90e6b837df3dd0afab6221a87963cc"></a>struct <a class="el" href="mem__alloc_8h.html#structmem__link">mem_link</a> *</td>
<td class="fieldname">
next</td>
<td class="fielddoc">
</td></tr>
</table>

</div>
</div>
<a name="structmem__alloc" id="structmem__alloc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structmem__alloc">&#9670;&nbsp;</a></span>mem_alloc</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct mem_alloc</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock">
<p class="definition">Definition at line <a class="el" href="mem__alloc_8h_source.html#l00050">50</a> of file <a class="el" href="mem__alloc_8h_source.html">mem_alloc.h</a>.</p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a5921b4ec4ba3b8fa0087a5211802f995"></a>struct <a class="el" href="mem__alloc_8h.html#structmem__link">mem_link</a></td>
<td class="fieldname">
free</td>
<td class="fielddoc">
</td></tr>
<tr><td class="fieldtype">
<a id="af373018dfb1f354faf143b9fb04a3ca4"></a>struct <a class="el" href="mem__alloc_8h.html#structmem__link">mem_link</a></td>
<td class="fieldname">
allocated</td>
<td class="fielddoc">
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ac37e826046364bcbc938be357d088dda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac37e826046364bcbc938be357d088dda">&#9670;&nbsp;</a></span>mem_alloc_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mem_alloc_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Initialize a memory allocator object</p>
<p>After the call, the allocator is initialized but "empty". To add allocatable memory regions, further initialize the allocator with <a class="el" href="mem__alloc_8h.html#affae27295ea2cd566c06dba6fb34835f">mem_alloc_add_free()</a>.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">m</td><td>The address of the memory allocator to initialize. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af51e1559cd8eb3aa3cc0c433fcfcaa71"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af51e1559cd8eb3aa3cc0c433fcfcaa71">&#9670;&nbsp;</a></span>mem_alloc_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mem_alloc_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> *&#160;</td>
          <td class="paramname"><em>m</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Destroy a memory allocator object</p>
<p>Frees all of the allocator's internal resources.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">m</td><td>The address of the memory allocator to destroy. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="affae27295ea2cd566c06dba6fb34835f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#affae27295ea2cd566c06dba6fb34835f">&#9670;&nbsp;</a></span>mem_alloc_add_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mem_alloc_add_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Add a memory region to an allocator.</p>
<p>The memory region is added to the allocatable space and is immediately ready for allocation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">m</td><td>The memory allocator object. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">address</td><td>The beginning address of the memory region. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>The size of the memory region. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success.</dd></dl>
<p>Example </p><div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> m;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="mem__alloc_8h.html#ac37e826046364bcbc938be357d088dda">mem_alloc_init</a>(&amp;m);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="mem__alloc_8h.html#affae27295ea2cd566c06dba6fb34835f">mem_alloc_add_free</a>(&amp;m, 0x4000, 4096)) {</div>
<div class="line">  <span class="comment">// handle error</span></div>
<div class="line">}</div>
<div class="ttc" id="amem__alloc_8h_html_ac37e826046364bcbc938be357d088dda"><div class="ttname"><a href="mem__alloc_8h.html#ac37e826046364bcbc938be357d088dda">mem_alloc_init</a></div><div class="ttdeci">void mem_alloc_init(struct mem_alloc *m)</div></div>
<div class="ttc" id="amem__alloc_8h_html_affae27295ea2cd566c06dba6fb34835f"><div class="ttname"><a href="mem__alloc_8h.html#affae27295ea2cd566c06dba6fb34835f">mem_alloc_add_free</a></div><div class="ttdeci">int mem_alloc_add_free(struct mem_alloc *m, uint64_t address, uint64_t size)</div></div>
<div class="ttc" id="amem__alloc_8h_html_structmem__alloc"><div class="ttname"><a href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a></div><div class="ttdef"><b>Definition:</b> <a href="mem__alloc_8h_source.html#l00050">mem_alloc.h:50</a></div></div>
</div><!-- fragment --> 
</div>
</div>
<a id="afdb4e638fb73f1199f739bdd4cad9b16"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdb4e638fb73f1199f739bdd4cad9b16">&#9670;&nbsp;</a></span>mem_alloc_get()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mem_alloc_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t *&#160;</td>
          <td class="paramname"><em>address</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Allocate memory</p>
<p>Retrieve an available memory address for a free block that is at least size bytes.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">m</td><td>The memory allocator object. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">address</td><td>The retrieved address for the allocation. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size</td><td>The request size in bytes. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success.</dd></dl>
<p>Example </p><div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> m;</div>
<div class="line">uint64_t addr = 0;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="mem__alloc_8h.html#ac37e826046364bcbc938be357d088dda">mem_alloc_init</a>(&amp;m);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="mem__alloc_8h.html#affae27295ea2cd566c06dba6fb34835f">mem_alloc_add_free</a>(&amp;m, 0x4000, 4096)) {</div>
<div class="line">  <span class="comment">// handle error</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">if (<a class="code" href="mem__alloc_8h.html#afdb4e638fb73f1199f739bdd4cad9b16">mem_alloc_get</a>(&amp;m, &amp;addr, 4096)) {</div>
<div class="line">  <span class="comment">// handle allocation error</span></div>
<div class="line">}</div>
<div class="ttc" id="amem__alloc_8h_html_afdb4e638fb73f1199f739bdd4cad9b16"><div class="ttname"><a href="mem__alloc_8h.html#afdb4e638fb73f1199f739bdd4cad9b16">mem_alloc_get</a></div><div class="ttdeci">int mem_alloc_get(struct mem_alloc *m, uint64_t *address, uint64_t size)</div></div>
</div><!-- fragment --> 
</div>
</div>
<a id="a7f633432ea4eea5c671b37645a7270a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7f633432ea4eea5c671b37645a7270a4">&#9670;&nbsp;</a></span>mem_alloc_put()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mem_alloc_put </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> *&#160;</td>
          <td class="paramname"><em>m</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint64_t&#160;</td>
          <td class="paramname"><em>address</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Free memory</p>
<p>Release a previously-allocated memory block.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">m</td><td>The memory allocator object. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">address</td><td>The address to free. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Non-zero on error. Zero on success.</dd></dl>
<p>Example </p><div class="fragment"><div class="line"><span class="keyword">struct </span><a class="code" href="mem__alloc_8h.html#structmem__alloc">mem_alloc</a> m;</div>
<div class="line">uint64_t addr = 0;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="mem__alloc_8h.html#ac37e826046364bcbc938be357d088dda">mem_alloc_init</a>(&amp;m);</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">if</span> (<a class="code" href="mem__alloc_8h.html#affae27295ea2cd566c06dba6fb34835f">mem_alloc_add_free</a>(&amp;m, 0x4000, 4096)) {</div>
<div class="line">  <span class="comment">// handle error</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">if (<a class="code" href="mem__alloc_8h.html#afdb4e638fb73f1199f739bdd4cad9b16">mem_alloc_get</a>(&amp;m, &amp;addr, 4096)) {</div>
<div class="line">  <span class="comment">// handle allocation error</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">...</div>
<div class="line"> </div>
<div class="line">if (<a class="code" href="mem__alloc_8h.html#a7f633432ea4eea5c671b37645a7270a4">mem_alloc_put</a>(&amp;m, addr)) {</div>
<div class="line">  <span class="comment">// handle free error</span></div>
<div class="line">}</div>
<div class="ttc" id="amem__alloc_8h_html_a7f633432ea4eea5c671b37645a7270a4"><div class="ttname"><a href="mem__alloc_8h.html#a7f633432ea4eea5c671b37645a7270a4">mem_alloc_put</a></div><div class="ttdeci">int mem_alloc_put(struct mem_alloc *m, uint64_t address)</div></div>
</div><!-- fragment --> 
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
