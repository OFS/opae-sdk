language: c
cache:
  - ccache
  - pip
compiler: gcc
install:
  - pip install --user pylint
  - pip install --user pycodestyle
  - pip install --user jsonschema

jobs:
  include:
    - stage: BAT
      script: scripts/test-codingstyle.sh
    - # BAT
      script: scripts/test-codingstyle-py.sh
    - # BAT
      script: scripts/test-build.sh
    - # BAT
      script: scripts/test-gtapi-mock-drv.sh
    - # BAT
      script: scripts/build-documentation.sh
addons:
  apt:
    packages:
      - libboost-all-dev
      - libjson-c-dev
      - uuid-dev
      - doxygen
after_success: |
  if [ -n "$GITHUB_API_KEY" ]; then
    cd mybuild_docs/sphinx/html
    git init
    git checkout -b gh-pages
    git add --all .
    git -c user.name='Abelardo Jara-Berrocal' -c user.email='abelardo.jara-berrocal@intel.com' commit -m init
    # Make sure to make the output quiet, or else the API token will leak!
    # This works because the API key can replace your password.
    git push -f -q https://abelardojarab:$GITHUB_API_KEY@github.com/OPAE/opae-doc-test gh-pages
  fi
